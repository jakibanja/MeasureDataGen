# Data Flow: Test Case â†’ Output Tables

## ğŸ“Š Complete Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PSA_MY2026_TestCase.xlsx                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Row: PSA_CE_02                                            â”‚  â”‚
â”‚  â”‚ - ID: PSA_CE_02                                          â”‚  â”‚
â”‚  â”‚ - Enrollment: 1/1/MY-1 TO 10/1/MY, 11/14/MY TO 12/31/MY â”‚  â”‚
â”‚  â”‚ - Visit: 2/1/MY                                          â”‚  â”‚
â”‚  â”‚ - CE=1 (Clinical Event flag)                            â”‚  â”‚
â”‚  â”‚ - Expected: Not Tested                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STEP 1: Parser (src/parser.py)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TestCaseParser.parse_scenarios()                         â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚ 1. Read Excel sheets (PSA_Measure, etc.)                â”‚  â”‚
â”‚  â”‚ 2. Find header row with #TC, MEM_NBR, etc.              â”‚  â”‚
â”‚  â”‚ 3. For each row:                                         â”‚  â”‚
â”‚  â”‚    a. Extract ID (PSA_CE_02)                            â”‚  â”‚
â”‚  â”‚    b. Parse enrollment dates with regex                  â”‚  â”‚
â”‚  â”‚    c. Parse visit dates                                  â”‚  â”‚
â”‚  â”‚    d. Detect compliance via patterns:                    â”‚  â”‚
â”‚  â”‚       - Look for "CE=1" â†’ PSA Test present âœ…           â”‚  â”‚
â”‚  â”‚       - Look for "CE=0" â†’ No PSA Test                   â”‚  â”‚
â”‚  â”‚    e. Extract product line, age, gender                  â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚ Output: Scenario dictionary                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Parsed Scenario Object                        â”‚
â”‚  {                                                              â”‚
â”‚    'id': 'PSA_CE_02',                                          â”‚
â”‚    'age': 70,                                                   â”‚
â”‚    'gender': 'M',                                               â”‚
â”‚    'product_line': 'Medicare',                                  â”‚
â”‚    'enrollment_spans': [                                        â”‚
â”‚      {'start': '1/1/MY-1', 'end': '10/1/MY'},                 â”‚
â”‚      {'start': '11/14/MY', 'end': '12/31/MY'}                 â”‚
â”‚    ],                                                           â”‚
â”‚    'visit_spans': [                                             â”‚
â”‚      {'date': '2/1/MY', 'type': 'Outpatient'}                 â”‚
â”‚    ],                                                           â”‚
â”‚    'compliant': ['PSA Test'],  â† DETECTED BY ENHANCED PARSER!  â”‚
â”‚    'excluded': [],                                              â”‚
â”‚    'overrides': {}                                              â”‚
â”‚  }                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           STEP 2: Engine Processing (main.py)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ _process_measure() - Line 108-193                        â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚ For each scenario (PSA_CE_02):                           â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚ 1. Generate Member Base (Line 160-163)                   â”‚  â”‚
â”‚  â”‚    â†’ engine.generate_member_base()                       â”‚  â”‚
â”‚  â”‚    â†’ Creates 1 row in PSA_MEMBER_IN                      â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚ 2. Generate Enrollments (Line 167-172)                   â”‚  â”‚
â”‚  â”‚    â†’ engine.generate_enrollments()                       â”‚  â”‚
â”‚  â”‚    â†’ Loops through enrollment_spans                      â”‚  â”‚
â”‚  â”‚    â†’ Creates 2 rows in PSA_ENROLLMENT_IN âœ…              â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚ 3. Generate Visits (Line 175-176)                        â”‚  â”‚
â”‚  â”‚    â†’ engine.generate_visits()                            â”‚  â”‚
â”‚  â”‚    â†’ Loops through visit_spans                           â”‚  â”‚
â”‚  â”‚    â†’ Creates 1 row in PSA_VISIT_IN âœ…                    â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚ 4. Generate Clinical Events (Line 179-186)               â”‚  â”‚
â”‚  â”‚    â†’ For each component in compliant list:               â”‚  â”‚
â”‚  â”‚    â†’ if 'PSA Test' in sc['compliant']: âœ…               â”‚  â”‚
â”‚  â”‚       â†’ engine.generate_clinical_event()                 â”‚  â”‚
â”‚  â”‚       â†’ Creates 1 row in PSA_LAB_IN âœ…                   â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚ 5. Generate Exclusions (Line 189-192)                    â”‚  â”‚
â”‚  â”‚    â†’ For each exclusion in excluded list                 â”‚  â”‚
â”‚  â”‚    â†’ Creates rows in appropriate tables                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        STEP 3: Data Generation (src/engine.py)                  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ A. generate_member_base() - Line 30-62                 â”‚   â”‚
â”‚  â”‚    Input: mem_id='PSA_CE_02', age=70, gender='M'       â”‚   â”‚
â”‚  â”‚    Output: 1 row with:                                  â”‚   â”‚
â”‚  â”‚      - MEM_NBR: PSA_CE_02                              â”‚   â”‚
â”‚  â”‚      - DOB: calculated from age                         â”‚   â”‚
â”‚  â”‚      - GENDER: M                                        â”‚   â”‚
â”‚  â”‚      - Fake name, address, SSN, etc.                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ B. generate_enrollments() - Line 95-188                â”‚   â”‚
â”‚  â”‚    Input: mem_id, product_line, spans=[2 spans]        â”‚   â”‚
â”‚  â”‚    Process:                                             â”‚   â”‚
â”‚  â”‚      FOR EACH span in enrollment_spans:                â”‚   â”‚
â”‚  â”‚        1. Parse start date: '1/1/MY-1' â†’ 2025-01-01   â”‚   â”‚
â”‚  â”‚        2. Parse end date: '10/1/MY' â†’ 2026-10-01      â”‚   â”‚
â”‚  â”‚        3. Create row with:                             â”‚   â”‚
â”‚  â”‚           - MEM_NBR: PSA_CE_02                         â”‚   â”‚
â”‚  â”‚           - ENR_START: 2025-01-01                      â”‚   â”‚
â”‚  â”‚           - ENR_END: 2026-10-01                        â”‚   â”‚
â”‚  â”‚           - PRODUCT_ID: 1 (Medicare)                   â”‚   â”‚
â”‚  â”‚           - BEN_MEDICAL: 1, BEN_RX: 1, etc.           â”‚   â”‚
â”‚  â”‚           - FLD00-FLD23: Monthly enrollment flags      â”‚   â”‚
â”‚  â”‚        4. Repeat for second span                       â”‚   â”‚
â”‚  â”‚    Output: 2 rows in PSA_ENROLLMENT_IN âœ…             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ C. generate_visits() - Line 190-214                    â”‚   â”‚
â”‚  â”‚    Input: mem_id, spans=[1 visit]                      â”‚   â”‚
â”‚  â”‚    Process:                                             â”‚   â”‚
â”‚  â”‚      FOR EACH span in visit_spans:                     â”‚   â”‚
â”‚  â”‚        1. Parse date: '2/1/MY' â†’ 2026-02-01           â”‚   â”‚
â”‚  â”‚        2. Create row with:                             â”‚   â”‚
â”‚  â”‚           - MEM_NBR: PSA_CE_02                         â”‚   â”‚
â”‚  â”‚           - CLAIM_ID: C_PSA_CE_02_01                   â”‚   â”‚
â”‚  â”‚           - SERV_DT: 2026-02-01                        â”‚   â”‚
â”‚  â”‚           - POS: 11 (Office)                           â”‚   â”‚
â”‚  â”‚           - CPT_1: 99213                               â”‚   â”‚
â”‚  â”‚    Output: 1 row in PSA_VISIT_IN âœ…                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ D. generate_clinical_event() - Line 216-263            â”‚   â”‚
â”‚  â”‚    Input: mem_id, component_name='PSA Test'            â”‚   â”‚
â”‚  â”‚    Process:                                             â”‚   â”‚
â”‚  â”‚      1. Find component in measure config               â”‚   â”‚
â”‚  â”‚      2. Get target table: PSA_LAB_IN                   â”‚   â”‚
â”‚  â”‚      3. Get VSD code for 'PSA Lab Test' value set     â”‚   â”‚
â”‚  â”‚      4. Create row with:                               â”‚   â”‚
â”‚  â”‚         - MEM_NBR: PSA_CE_02                           â”‚   â”‚
â”‚  â”‚         - LAB_SCR_DT: 2026-06-01                       â”‚   â”‚
â”‚  â”‚         - LAB_CPT: 84153 (from VSD)                    â”‚   â”‚
â”‚  â”‚         - LAB_VALUE: 1.0                                â”‚   â”‚
â”‚  â”‚    Output: 1 row in PSA_LAB_IN âœ…                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STEP 4: Write to Excel (main.py)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Lines 220-235: Write each table to Excel                 â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚ For each table in data_store:                            â”‚  â”‚
â”‚  â”‚   1. Convert list of dicts to DataFrame                  â”‚  â”‚
â”‚  â”‚   2. Write to Excel sheet                                â”‚  â”‚
â”‚  â”‚   3. Print row count                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           OUTPUT: PSA_MY2026_Mockup_v15.xlsx                    â”‚
â”‚                                                                 â”‚
â”‚  Sheet: PSA_MEMBER_IN                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ MEM_NBR  â”‚ DOB        â”‚ GENDER â”‚ FIRST_NAME â”‚ ...        â”‚  â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚  â”‚ PSA_CE_02â”‚ 1956-06-15 â”‚ M      â”‚ John       â”‚ ...        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  Sheet: PSA_ENROLLMENT_IN                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ MEM_NBR  â”‚ ENR_START  â”‚ ENR_END    â”‚ PRODUCT_ID â”‚ ...    â”‚  â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚  â”‚ PSA_CE_02â”‚ 2025-01-01 â”‚ 2026-10-01 â”‚ 1          â”‚ ...    â”‚  â”‚
â”‚  â”‚ PSA_CE_02â”‚ 2026-11-14 â”‚ 2026-12-31 â”‚ 1          â”‚ ...    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  Sheet: PSA_VISIT_IN                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ MEM_NBR  â”‚ CLAIM_ID        â”‚ SERV_DT    â”‚ POS â”‚ CPT_1   â”‚  â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚  â”‚ PSA_CE_02â”‚ C_PSA_CE_02_01  â”‚ 2026-02-01 â”‚ 11  â”‚ 99213   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  Sheet: PSA_LAB_IN                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ MEM_NBR  â”‚ LAB_SCR_DT â”‚ LAB_CPT â”‚ LAB_VALUE â”‚ ...        â”‚  â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚  â”‚ PSA_CE_02â”‚ 2026-06-01 â”‚ 84153   â”‚ 1.0       â”‚ ...        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Key Points

### 1. **Multiple Enrollments** âœ…
- **Source:** `enrollment_spans` array in parsed scenario
- **Processing:** `engine.generate_enrollments()` loops through each span
- **Result:** One row per enrollment period
- **PSA_CE_02:** 2 enrollment spans â†’ 2 rows in PSA_ENROLLMENT_IN

### 2. **Multiple Visits** âœ…
- **Source:** `visit_spans` array in parsed scenario
- **Processing:** `engine.generate_visits()` loops through each visit
- **Result:** One row per visit
- **PSA_CE_02:** 1 visit span â†’ 1 row in PSA_VISIT_IN

### 3. **Clinical Events (Labs)** âœ…
- **Source:** `compliant` array in parsed scenario
- **Detection:** Enhanced parser recognizes `CE=1` pattern
- **Processing:** `engine.generate_clinical_event()` for each compliant component
- **Result:** One row per clinical event
- **PSA_CE_02:** 'PSA Test' in compliant â†’ 1 row in PSA_LAB_IN

### 4. **Date Parsing**
- **Format:** Supports `MY`, `MY-1`, `MY+1`, absolute dates
- **Examples:**
  - `1/1/MY` â†’ 2026-01-01
  - `1/1/MY-1` â†’ 2025-01-01
  - `12/31/MY` â†’ 2026-12-31

### 5. **VSD Integration**
- **Purpose:** Get real clinical codes from Value Set Directory
- **Usage:** For PSA Test, Hospice, Prostate Cancer, etc.
- **Fallback:** Uses hardcoded defaults if VSD not available

## ğŸ“Š Data Flow Summary

```
Test Case Row
    â†“
Parser extracts:
  - ID, age, gender, product line
  - enrollment_spans[] (multiple periods)
  - visit_spans[] (multiple visits)
  - compliant[] (CE=1 detected as 'PSA Test')
    â†“
Engine generates:
  - 1 member row
  - N enrollment rows (one per span)
  - M visit rows (one per visit)
  - K lab rows (one per compliant component)
    â†“
Write to Excel:
  - PSA_MEMBER_IN (1 row)
  - PSA_ENROLLMENT_IN (N rows)
  - PSA_VISIT_IN (M rows)
  - PSA_LAB_IN (K rows)
```

## âœ… Verification

For PSA_CE_02:
- âœ… **Input:** 2 enrollment periods, 1 visit, CE=1
- âœ… **Output:** 2 enrollment rows, 1 visit row, 1 lab row
- âœ… **All data correctly populated from test case!**
